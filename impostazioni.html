<!DOCTYPE html>
<html lang="it" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delivery Vesuviano</title>
  <link rel="icon" href="img/icona_dv.png">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito">
</head>
<body>

<!-- Sezione Header -->
<header>
  <a class="home-link">Delivery Vesuviano</a>
</header>

<!-- Contenitore flessibile per i bottoni -->
<div class="button-container">

  <!-- Bottone per i crediti del progetto -->
  <a href="credits.html" class="credits-button-link">
    <button class="credits-button">
      <span class="button-content"></span>
      <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><path
        fill="#ffff00"
        d="M88 0C74.7 0 64 10.7 64 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1C120.5 112.3 128 119.9 128 136c0 13.3 10.7 24 24
        24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C119.5 47.7 112 40.1 112 24c0-13.3-10.7-24-24-24zM32 192c-17.7
        0-32 14.3-32 32V416c0 53 43 96 96 96H288c53 0 96-43 96-96h16c61.9 0 112-50.1 112-112s-50.1-112-112-112H352
        32zm352 64h16c26.5 0 48 21.5 48 48s-21.5 48-48 48H384V256zM224 24c0-13.3-10.7-24-24-24s-24 10.7-24 24c0 38.9
        23.4 59.4 39.1 73.1l1.1 1C232.5 112.3 240 119.9 240 136c0 13.3 10.7 24 24 24s24-10.7
        24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C231.5 47.7 224 40.1 224 24z"/></svg></span>
    </button>
  </a>

  <!-- Bottone per il GitHub del progetto -->
  <a href="https://github.com/Heetas/Delivery-Vesuviano" class="github-button-link">
    <button class="github-button">
      <span class="button-content"></span>
      <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" width="18" viewBox="0 0 496 512"><path
        fill="#ffff00" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6
        3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9
        .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0
        110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6
        0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1
        16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27
        69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8
        31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3
        12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2
        1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7
        .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3
        .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9
        0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
    </button>
  </a>

  <!-- Bottone per il carrello con collegamento diretto a carrello.html -->
  <a href="carrello.html" class="cart-button-link">
    <button class="cart-button">
      <span class="button-content"></span>
      <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="18" viewBox="0 0 576 512">
        <path fill="#ffea00" d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3
        0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5
        23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7
        48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/></svg></span>
    </button>
  </a>

  <!-- Bottone per il login dell'utente -->
  <a href="login.html" class="login-button-link" id="loginButton">
    <button class="login-button">
      <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="14" viewBox="0 0 448 512">
        <path fill="#ffea00" d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0
        498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"/></svg></span>
      <span class="button-content"></span>
    </button>
  </a>

  <!-- Bottone per la home -->
  <a href="index.html" class="home-button-link">
    <button class="home-button">
      <span class="button-content"></span>
      <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="18" viewBox="0 0 576 512">
        <path fill="#ffff00" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2
        0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0
        22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9
        .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg></span>
    </button>
  </a>
</div>

<main style="display: flex; justify-content: center; align-items: center">
  <div style="width: 50%;">
    <h1 style="text-align: center;">Impostazioni del profilo</h1>

    <form id="emailForm" style="margin-bottom: 1.25rem;">
      <label for="email">Email:</label><br>
      <div style="display: flex; justify-content: space-between; width: 46.875rem">
        <input type="email" id="email" name="email" disabled>
        <div style="margin-left: 3.125rem">
          <button class="editButton">
            Modifica
          </button>
        </div>
      </div>
    </form>

    <form id="passwordForm" style="margin-bottom: 1.25rem;">
      <label for="password">Password:</label><br>
      <div style="display: flex; justify-content: space-between; width: 46.875rem">
        <input type="password" id="password" name="password" value="********" disabled>
        <div style="margin-left: 3.125rem">
          <button class="editButton">Modifica</button>
        </div>
      </div>
    </form>

    <h1 style="text-align: center; margin-top: 1.25rem;">Impostazioni di consegna</h1>
    <form id="addressForm" style="margin-top: 1.25rem; margin-bottom: 1.25rem;">
      <div style="display: flex; flex-direction: column; align-items: flex-start; width: 31.25rem">
        <label for="via">Via:</label><br>
        <input type="text" id="via" name="via" disabled><br>
        <label for="citta">Citt√†:</label><br>
        <input type="text" id="citta" name="citta" disabled><br>
        <label for="cap">CAP:</label><br>
        <input type="text" id="cap" name="cap" disabled><br>
        <label for="citofono">Citofono:</label><br>
        <input type="text" id="citofono" name="citofono" disabled><br>
        <button class="editButton">Modifica</button>
      </div>
    </form>

    <div style="display: flex; justify-content: center; align-items: center; margin-top: 1.25rem">
      <button id="logout-button">Logout</button>
      <span style="margin-right: 0.625rem;"></span>
      <button id="delete-button">Elimina account</button>
    </div>
  </div>
</main>

<!-- Sezione Footer -->
<footer>
  <p>&copy; 2023 Delivery Vesuviano. All rights reserved.</p>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const userToken = localStorage.getItem('token');
    console.log('User token ID:', userToken);

    if (userToken) {
      fetch(`http://localhost:3000/api/user/${userToken}`)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log(data);
          const userData = data[0];

          // Precompila i campi del modulo con i dati dell'utente
          document.getElementById('email').value = userData.EMAIL_CLIENTE;
          document.getElementById('password').value.disabled = userData.PASSWORD_CLIENTE;
          document.getElementById('via').value = userData.VIA_CLIENTE;
          document.getElementById('citta').value = userData.CITTA_CLIENTE;
          document.getElementById('cap').value = userData.CAP_CLIENTE;
          document.getElementById('citofono').value = userData.CITOFONO_CLIENTE;
        });
    }

    const emailForm = document.getElementById('emailForm');
    const passwordForm = document.getElementById('passwordForm');
    const addressForm = document.getElementById('addressForm');
    const editButtons = document.getElementsByClassName('edit-button');
    const deleteButton = document.getElementById('delete-button');
    const logoutButton = document.getElementById('logout-button');

    Array.from(editButtons).forEach(function (editButton) {
      editButton.addEventListener('click', function () {
        const inputField = this.previousElementSibling;
        inputField.disabled = false;
      });
    });

    // Applicazione API per la modifica dell'email
    emailForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const email = document.getElementById('email').value;

      fetch(`http://localhost:3000/api/update/email/${userToken}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userToken}`
        },
        body: JSON.stringify({email}),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            document.getElementById('email').disabled = true;
          } else {
            console.error(data.message);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

    // Applicazione API per la modifica della password
    passwordForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const password = document.getElementById('password').value;

      fetch(`http://localhost:3000/api/update/password/${userToken}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userToken}`
        },
        body: JSON.stringify({password}),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            document.getElementById('password').disabled = true;
          } else {
            console.error(data.message);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

    // Applicazione API per la modifica dell'indirizzo di consegna
    addressForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const via = document.getElementById('via').value;
      const citta = document.getElementById('citta').value;
      const cap = document.getElementById('cap').value;
      const citofono = document.getElementById('citofono').value;

      fetch(`http://localhost:3000/api/update/address/${userToken}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userToken}`
        },
        body: JSON.stringify({via, citta, cap, citofono}),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            document.getElementById('via').disabled = true;
            document.getElementById('citta').disabled = true;
            document.getElementById('cap').disabled = true;
            document.getElementById('citofono').disabled = true;
          } else {
            console.error(data.message);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

    // Applicazione API per il logout
    logoutButton.addEventListener('click', function (e) {
      e.preventDefault();

      fetch(`http://localhost:3000/api/logout/${userToken}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userToken}`
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            window.location.href = "login.html"
          } else {
            console.error(data.message);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

    // Applicazione API per l'eliminazione dell'account
    deleteButton.addEventListener('click', function (e) {
      e.preventDefault();

      fetch(`http://localhost:3000/api/delete/${userToken}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userToken}`
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            window.location.href = "login.html"
          } else {
            console.error(data.message);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });
  });
</script>

<script src="js/main.js"></script>
</body>
</html>
